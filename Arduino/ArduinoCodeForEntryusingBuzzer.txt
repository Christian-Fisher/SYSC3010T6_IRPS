#include <Wire.h>
// Include the Servo Motor library
 #include <Servo.h>
//Iclude the Keypad library
 #include <Keypad.h>


 #define PIN_CodeLength 4;

 Servo servoMotor;
 int IRsensor1=0;
 int IRsensor2=0;
 int ledPin=13; // same as mentioned below
 int signalPin = 12;// need to edit based on the connection for pin code
 float sensorRightValue;
 float sensorLeftValue;
 boolean range;

 //Buzzer+Keypad
 int Buzzer_pin=14; 
 const byte ROWS = 4; //four rows
 const byte COLS = 4; //four columns
 char keys[ROWS][COLS] = {
 
  {'1','2','3','A'},
 
  {'4','5','6','B'},
 
  {'7','8','9','C'},
 
  {'*','0','#','D'}   
 
}
 byte rowPins[ROWS] = {13, 12, 11, 10}; //connect to the row pinouts of the keypad
 byte colPins[COLS] = {9, 8, 7, 6}; //connect to the column pinouts of the keypad
 Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );

 
 void setup(){
    Serial.begin(9600);        //Serial connection initial setup at 9600 bits of data per second
    pinMode(IRsensor1,INPUT);  //setting the first IR sensor as input
    pinMode(IRsensor2,INPUT);  //setting the second IR sensor as input
    pinMode(13,OUTPUT);        //setting the pin 13 in the arduino board as output pin
    pinMode(buzz_pin, OUTPUT); //buzzer pin mode set to ON
    servoMotor.attach(9);      // attaching the servo motor function to pin 9
    servoMotor.write(0);       // intial set up of the position of the servo motor which is now at 0 degrees

 }
 
 void loop(){
      sensorRightValue=analogRead(IRsensor1); //Can also use digital read 
      sensorLeftValue=analogRead(IRsensor2); 
      range = distance(sensorRightValue,sensorLeftValue);
      char key = keypad.getKey();  //Variable to store pressed key
 
 
  if (key){
    Serial.println(key); //Prints the key in serial monitor
    delay(1000);
    }
 
    if (key == 5){
    Serial.println(key); //Prints the key in serial monitor
    digitalWrite (buzz_pin,HIGH);// Turn ON Buzzer
    Serial.println(Buzzer ON);
    delay(1000);
    digitalWrite (buzz_pin,LOW); //Turn OFF Buzzer
    Serial.println(Buzzer OFF);

      Serial.print("IR sensor 1 = ");
      Serial.print(sensorRightValue);
      Serial.print(", IR sensor 2");
      Serial.println();


      boolean distance(float sensorRightValue, float sensorLeftValue){
         if(sensorRightValue>=400 && sensorRightValue<=700 || sensorLeftValue>=400 && sensorLeftValue<=700){ //can change the range depending on the situation
            return true;
         } else return false;
      }

      void open(){
         int rotate = 0;
         for(rotate = 0;rotate <= 90;rotate += 1){   //rotating the motor to 90 degrees signifies the open gate
            servoMotor.write(rotate);
            delay(10000);
         }
         delay(1000);
      }

      void close(){
         int rotate = 0;
         for(rotate = 90; rotate >= 0; rotate -= 5){
            servoMotor.write(rotate);
            delay(10000);
         }
         delay(1000);
      }

      if(range){
         entry();
         open();
         delay(1000);
         sensorRightValue = analogRead(IRsensor1);
         sensorLeftValue = analogRead(IRsensor2);
         range = distance(sensorRightValue, sensorLeftValue);

         if(range){
            close();
            delay(1000);
            sensorRightValue = analogRead(IRsensor1);
            sensorLeftValue = analogRead(IRsensor2);
         } else {
            Serial.println("checks for car in detection range");
            range = distance(sensorRightValue, sensorLeftValue); 
         }
      } else {
         Serial.println("checks for car in detection range");
         range = distance(sensorRightValue, sensorLeftValue); 
      }
 }
